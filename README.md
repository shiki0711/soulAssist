# soulAssist
某科学的手游辅助工具研究

## 功能
通过篡改/注入客户端程序、客户端/服务器间的通信数据，实现部分游戏项目作弊:  
* 主要功能:
  * 普通地下城三星通关。无论实际用时多久，通关评价一律为三星。
  * 魔王之塔强制通关。即使战斗失败，也能够成功通关。
* TODO:
  * ~~修改次元之门掉落全部变为红钻碎片~~
  * ~~修改扭曲地下城掉咯碎片数量~~
  * 普通地下城强制通关。即使战斗失败，也能够成功通关。
  * 竞技场强制获胜。即使挑战失败，也能够取得胜利。
  * 扭曲地下城强制通关。即使战斗失败，也能够成功通关。  

(其余游戏内容由于是在服务器端进行处理，因此无法篡改)

## 实现方案

### A. 反编译修改游戏源程序 
游戏客户端附带有反作弊程序(xingcode3)，对源程序的修改可以被反作弊程序检测到，进而强制结束游戏进程。  
反作弊程序代码位于游戏内libxigncode.so中，为C++原生程序，并且代码经过了混淆，破解难度较大，需要使用IDA Pro进行动态调试，查找并修改反作弊代码。此外，由于反作弊程序与服务器之间有heartbeat，因此并不能简单的禁用反作弊程序。  
相比其他方案，A方案的优点是对手机没有任何限制，一旦破解成功，直接安装修改过的apk即可。  
由于libxigncode.so尚未成功破解，方案A搁置中...  
  
反编译、动态调试方法及相关工具: T.B.D

### B. 动态注入代码到游戏进程
相比方案A，由于不修改程序文件，可以绕过反作弊程序对apk的校验。但是从xingcode3官网的介绍来看，xingcode3会通过校验内存中的代码段进行反注入。因此，方案B尚未做尝试。

### C. 修改客户端/服务器间通信数据
通过添加glibc/内核hook代码，拦截并修改客户端/服务器间的通信数据，达到欺骗服务器的目的。  
相比方案A，B，由于无需修改/注入游戏程序，因此可以完全避开反作弊程序。但是添加glibc/内核hook代码需要手机具有root权限。
#### glibc hook
常用的Linux系统可以通过添加LD_PRELOAD环境变量来将动态链接库函数替换为自定义代码。但在Android系统中上述环境变量似乎对app无法产生效果。  
关于glibc hook，猜想使用Xposed Module可以实现。

#### 内核hook
详细参见[说明](https://github.com/shiki0711/soulAssist/tree/master/kmoduleSyscallHijack)  
内核代码hook是所有方案中最繁琐，限制最多的方式。但由于实现简单，目前暂时使用此方案实现了作弊程序。

#### 服务器/客户端通信加密破解
详细参见[说明](https://github.com/shiki0711/soulAssist/tree/master/tools/packetAnalyzer)
